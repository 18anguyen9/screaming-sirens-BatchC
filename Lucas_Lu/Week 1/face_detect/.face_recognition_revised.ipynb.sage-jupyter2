{"backend_state":"running","connection_file":"/projects/4559949a-12be-48f9-8c58-b62a9ca1e674/.local/share/jupyter/runtime/kernel-8e03ef2c-a8b1-443b-b091-7295aed62db1.json","kernel":"cv_env","kernel_error":"","kernel_state":"idle","kernel_usage":{"cpu":0,"memory":0},"metadata":{"colab":{"collapsed_sections":[],"name":"aicamp_face_recognition.ipynb","provenance":[]},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.8.13"}},"trust":true,"type":"settings"}
{"cell_type":"code","end":1658426703573,"exec_count":4,"id":"ad5a94","input":"import os, json  # json for pretty output\nfrom serpapi import GoogleSearch\nimport requests\n\ndef get_google_images():\n    params = {\n        # \"api_key\": os.environ.get(\"SERPAPI_KEY\"),\n        \"api_key\": \"SERPAPI_KEY\",\n        \"engine\": \"google\",\n        \"q\": \"Cat\",\n        \"tbm\": \"isch\",\n        \"ijn\": 0\n    }\n\n    search = GoogleSearch(params)\n    results = search.get_dict()\n\n    # print(json.dumps(results['suggested_searches'], indent=2, ensure_ascii=False))\n    print(json.dumps(results[\"images_results\"], indent=2, ensure_ascii=False))\n    # save files to /SerpApi_Images/ if it doesn't exist create the folder\n    if not os.path.exists(\"./SerpApi_Images/\"):\n        os.makedirs(\"./SerpApi_Images/\")\n\n    # -----------------------\n    # Downloading images\n    headers = {\n        \"user-agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36\"}\n\n    for index, image in enumerate(results[\"images_results\"]):\n\n        try:\n            print(f\"Downloading {index} image...\")\n\n            # filepath is current working directory + SerpApi_Images + params[\"q\"] + index + .jpg\n            filepath = os.path.join(\"./SerpApi_Images/\", params[\"q\"] + str(index) + \".jpg\")\n\n            response = requests.get(image['original'], headers=headers).content\n            with open(filepath, \"wb\") as f:\n                f.write(response)\n\n        except Exception as e:\n            print(e)\n            print(f\"Error downloading {index} image. Error =\", e)\n\nget_google_images()","kernel":"cv_env","output":{"0":{"name":"stdout","text":"https://serpapi.com/search\n"},"1":{"ename":"KeyError","evalue":"'images_results'","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mKeyError\u001b[0m                                  Traceback (most recent call last)","Input \u001b[0;32mIn [4]\u001b[0m, in \u001b[0;36m<cell line: 45>\u001b[0;34m()\u001b[0m\n\u001b[1;32m     42\u001b[0m             \u001b[38;5;28mprint\u001b[39m(e)\n\u001b[1;32m     43\u001b[0m             \u001b[38;5;28mprint\u001b[39m(\u001b[38;5;124mf\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mError downloading \u001b[39m\u001b[38;5;132;01m{\u001b[39;00mindex\u001b[38;5;132;01m}\u001b[39;00m\u001b[38;5;124m image. Error =\u001b[39m\u001b[38;5;124m\"\u001b[39m, e)\n\u001b[0;32m---> 45\u001b[0m \u001b[43mget_google_images\u001b[49m\u001b[43m(\u001b[49m\u001b[43m)\u001b[49m\n","Input \u001b[0;32mIn [4]\u001b[0m, in \u001b[0;36mget_google_images\u001b[0;34m()\u001b[0m\n\u001b[1;32m     16\u001b[0m results \u001b[38;5;241m=\u001b[39m search\u001b[38;5;241m.\u001b[39mget_dict()\n\u001b[1;32m     18\u001b[0m \u001b[38;5;66;03m# print(json.dumps(results['suggested_searches'], indent=2, ensure_ascii=False))\u001b[39;00m\n\u001b[0;32m---> 19\u001b[0m \u001b[38;5;28mprint\u001b[39m(json\u001b[38;5;241m.\u001b[39mdumps(\u001b[43mresults\u001b[49m\u001b[43m[\u001b[49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[38;5;124;43mimages_results\u001b[39;49m\u001b[38;5;124;43m\"\u001b[39;49m\u001b[43m]\u001b[49m, indent\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m2\u001b[39m, ensure_ascii\u001b[38;5;241m=\u001b[39m\u001b[38;5;28;01mFalse\u001b[39;00m))\n\u001b[1;32m     20\u001b[0m \u001b[38;5;66;03m# save files to /SerpApi_Images/ if it doesn't exist create the folder\u001b[39;00m\n\u001b[1;32m     21\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m os\u001b[38;5;241m.\u001b[39mpath\u001b[38;5;241m.\u001b[39mexists(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124m./SerpApi_Images/\u001b[39m\u001b[38;5;124m\"\u001b[39m):\n","\u001b[0;31mKeyError\u001b[0m: 'images_results'"]}},"pos":16,"start":1658426702525,"state":"done","type":"cell"}
{"cell_type":"code","exec_count":11,"id":"b1aa0d","input":"# Detect faces in the image\nfaces = faceCascade.detectMultiScale(\n    gray,\n    scaleFactor=1.1,\n    minNeighbors=5,\n    minSize=(30, 30),\n    flags = cv2.CASCADE_SCALE_IMAGE\n)","metadata":{"id":"qOH1m1Z69J9h","vscode":{"languageId":"python"}},"pos":11,"type":"cell"}
{"cell_type":"code","exec_count":12,"id":"870ed4","input":"#print the number of faces found\nprint(f\"Found {len(faces)} faces!\")\n\n# Draw a rectangle around the faces\nfor (x, y, w, h) in faces:\n    cv2.rectangle(picture, (x, y), (x+w, y+h), (0, 255, 0), 2)\n\n#show the image with the rectangle drawn around it\nplt.axis(\"off\")\nplt.imshow(picture)\nplt.show()","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":265},"id":"Vx2rUAOH9N6p","outputId":"8e0c08b1-d83d-4bfe-bdff-cc4887bc32fb","vscode":{"languageId":"python"}},"output":{"0":{"name":"stdout","output_type":"stream","text":"Found 4 faces!\n"},"1":{"data":{"image/png":"ff7b491786c0f84a9c70fb2f0682bc4746125318","text/plain":"<Figure size 432x288 with 1 Axes>"},"exec_count":12,"metadata":{"needs_background":"light"},"output_type":"execute_result"}},"pos":13,"type":"cell"}
{"cell_type":"code","exec_count":15,"id":"7c83c7","input":"# Your code here\nimport cv2\nfrom skimage import io\nimport matplotlib.pyplot as plt\n\npicture = io.imread(\"lebron-james.jpg\")\ngray = cv2.cvtColor(picture, cv2.COLOR_RGB2GRAY)\nplt.axis(\"off\")\nplt.imshow(gray, cmap=\"gray\")\nplt.show()","metadata":{"vscode":{"languageId":"python"}},"output":{"0":{"data":{"image/png":"af23173a32698659f30647751334709bfe49eae3","text/plain":"<Figure size 432x288 with 1 Axes>"},"exec_count":15,"metadata":{"needs_background":"light"},"output_type":"execute_result"}},"pos":15,"type":"cell"}
{"cell_type":"code","exec_count":2,"id":"133200","input":"#import dependencies\nimport cv2\nfrom skimage import io\nimport matplotlib.pyplot as plt","metadata":{"id":"MvO5PwWjmXDl","vscode":{"languageId":"python"}},"pos":2,"type":"cell"}
{"cell_type":"code","exec_count":3,"id":"8d6eae","input":"#get the cascade classifier from the cv2 filepath\nfaceCascade = cv2.CascadeClassifier(cv2.data.haarcascades + 'haarcascade_frontalface_default.xml')\n\n#url of the image\nurl = \"https://image.shutterstock.com/image-photo/young-successful-team-four-business-260nw-289449125.jpg\"","metadata":{"id":"3AeOvLI76slQ","vscode":{"languageId":"python"}},"pos":4,"type":"cell"}
{"cell_type":"code","exec_count":6,"id":"62a821","input":"plt.axis(\"off\")\nplt.imshow(gray, cmap=\"gray\")\nplt.show()","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":248},"id":"DiclYgTz5gXN","outputId":"6d26173c-3062-48a6-dadf-2814787c3130","vscode":{"languageId":"python"}},"output":{"0":{"data":{"image/png":"ed54dd3b23ed827cf125f84c001020a6ca0db3db","text/plain":"<Figure size 432x288 with 1 Axes>"},"exec_count":6,"metadata":{"needs_background":"light"},"output_type":"execute_result"}},"pos":9,"type":"cell"}
{"cell_type":"code","exec_count":8,"id":"8d8ac8","input":"#read the picture from the url and turn it to BGR format\npicture = io.imread(url)\n\n#convert picture to grayscale\ngray = cv2.cvtColor(picture, cv2.COLOR_RGB2GRAY)","metadata":{"id":"rvtpyzf48e_r","vscode":{"languageId":"python"}},"pos":6,"type":"cell"}
{"cell_type":"code","exec_count":9,"id":"be16ae","input":"plt.axis(\"off\")\nplt.imshow(picture)\nplt.show()","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":248},"id":"Dr_8wri_5Y_z","outputId":"03a9bca6-f0f9-4208-963f-e2aca56329ad","vscode":{"languageId":"python"}},"output":{"0":{"data":{"image/png":"b82f3569b7b0ed6b8b5fd85cc4ada1b234f73775","text/plain":"<Figure size 432x288 with 1 Axes>"},"exec_count":9,"metadata":{"needs_background":"light"},"output_type":"execute_result"}},"pos":8,"type":"cell"}
{"cell_type":"markdown","id":"18d137","input":"### Display the Results\n\nThe display will first output the length of the list of faces, or the number of faces, to the user. Then, for each of the face coordinates, cv2 will draw a green rectangle around the faces. Finally cv2_imshow function will display the main image with the rectangles drawn on top.","metadata":{"id":"g6MqDa0P9MVz"},"pos":12,"type":"cell"}
{"cell_type":"markdown","id":"41e0ff","input":"### Preprocessing the Image\n\nWe first use the io.imread() function to get the image from the url. However, we need to convert it to grayscale format because we are using the OpenCV classifier. The io image originally comes in RGB color. This is the image we will use to display the boxes around the faces. We also need to convert the image to grayscale as the OpenCV model only works on grayscale faces. ","metadata":{"id":"PXRqLJQ58el8"},"pos":5,"type":"cell"}
{"cell_type":"markdown","id":"59b933","input":"### Dependencies\n\nFirst we will import the dependencies, or libraries, necessary for this project. The dependencies are OpenCV for the face detector, skimage for reading an image from a url, and pyplot for displaying the image in this notebook.","metadata":{"id":"6QPj94nu6zrE"},"pos":1,"type":"cell"}
{"cell_type":"markdown","id":"7cc2b4","input":"## Displaying the Image\n\nWe set axis to off to avoid the annoying tickmarks on the x and y axis of a pyplot plot. We then use the pyplot imshow and then show functions to show the image. We also want to view the grayscale version of the image so we do the same thing but set the image color map parameter to gray.","metadata":{"id":"2wpc7TRomH3O"},"pos":7,"type":"cell"}
{"cell_type":"markdown","id":"81df44","input":"### Getting the Image and Classifier\n\nHere we will get the face detector from the OpenCV library and store it in the faceCascade library. We then put the image address/url of the image. The example url below is an image of a group of four people. If you want, you can also upload a picture of yourself to google colab and put the filepath instead of the url to run facial detection on images from your own computer. ","metadata":{"id":"6VqccN6i7k3c"},"pos":3,"type":"cell"}
{"cell_type":"markdown","id":"8fe951","input":"# Let's Build An AI Face Detector!\n\nIn just a couple, simple lines you will be able to build your very own face detector where you can input a image url and the face detector will draw boxes around the faces before displaying the results of **AI face detection.**\n\n### Theory Behind the Model\nFirst the face detector splits the image into multiple small sections. For each section, it first runs a series of general facial tests. The sections that pass these tests move on to the next, more specific, facial tests and the ones that don't pass are disregarded. On the sections that the face detector is unsure about, it runs more and more tests (a total of 6000) until the face detector can be positive that the section is part of a face. It is like a cascade, or waterfall, of tests which is why the face detector we use is called a cascade classifier.","metadata":{"id":"npPdoLfV6RlL"},"pos":0,"type":"cell"}
{"cell_type":"markdown","id":"c0b44a","input":"## Try some images of your own.\n\nThere are some other images in this folder you can experiment with, or you can use your own image to try and detect faces!\n\n","pos":14,"type":"cell"}
{"cell_type":"markdown","id":"d6904a","input":"### Detect the Faces\nWe execute the detectMultiScale method to detect the faces. \n\n* The first input is the **grayscale image** we want to use for detection. \n\n* **scaleFactor** is used if the image is too large and we make it smaller by a factor of 1.1 as the face detector can only detect faces in a certain range of sizes.\n \n* **minNeighbors** is one of the most important parameters in the model. Remember, the image is first split into many small sections before classification. If minNeighbors is 5, there must be 5 other parts, or sections, of a face around a certain section if that section can be classified as part of a face (because usually one part of the face is surrounded by other parts). If you make minNeighbors larger, than the model will be much more sure about the faces it detects but it might miss some faces. If you make this smaller, the model will detect more faces but it will also make more mistakes. \n\n* **minSize** is the minimum size a face must be in order for it to be viable for detection.  \n\nThe method will output the coordinates of all the faces found.","metadata":{"id":"FcClRtog9Fpf"},"pos":10,"type":"cell"}
{"id":"7eb75e","input":"","pos":17,"type":"cell"}
{"id":0,"time":1658426333599,"type":"user"}
{"last_load":1658426333674,"type":"file"}